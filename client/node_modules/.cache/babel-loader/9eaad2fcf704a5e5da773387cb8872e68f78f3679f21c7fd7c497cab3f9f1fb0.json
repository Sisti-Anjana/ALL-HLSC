{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\LibsysAdmin\\\\OneDrive - Libsys IT Services Private Limited\\\\Desktop\\\\ALLLL HLSC\\\\client\\\\src\\\\context\\\\TenantContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { useAuth } from './AuthContext';\nimport { adminService } from '../services/adminService';\nimport { useQuery } from '@tanstack/react-query';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TenantContext = /*#__PURE__*/createContext(undefined);\nexport const useTenant = () => {\n  _s();\n  const context = useContext(TenantContext);\n  if (!context) {\n    throw new Error('useTenant must be used within TenantProvider');\n  }\n  return context;\n};\n_s(useTenant, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const TenantProvider = ({\n  children\n}) => {\n  _s2();\n  const {\n    user\n  } = useAuth();\n  const isSuperAdmin = (user === null || user === void 0 ? void 0 : user.role) === 'super_admin';\n\n  // Fetch all tenants for super admin\n  const {\n    data: tenants = [],\n    isLoading\n  } = useQuery({\n    queryKey: ['tenants'],\n    queryFn: adminService.getTenants,\n    enabled: isSuperAdmin // Only fetch if super admin\n  });\n\n  // Initialize selected tenant from localStorage or use user's tenant\n  const [selectedTenantId, setSelectedTenantIdState] = useState(() => {\n    if (!isSuperAdmin) {\n      // Regular users use their own tenant_id\n      return (user === null || user === void 0 ? void 0 : user.tenantId) || null;\n    }\n\n    // Super admin: try to load from localStorage\n    try {\n      const stored = localStorage.getItem('selectedTenantId');\n      return stored || null;\n    } catch {\n      return null;\n    }\n  });\n\n  // Update localStorage when selected tenant changes\n  useEffect(() => {\n    if (isSuperAdmin && selectedTenantId) {\n      localStorage.setItem('selectedTenantId', selectedTenantId);\n    } else if (isSuperAdmin && !selectedTenantId) {\n      localStorage.removeItem('selectedTenantId');\n    }\n  }, [selectedTenantId, isSuperAdmin]);\n\n  // Set selected tenant function\n  const setSelectedTenantId = tenantId => {\n    setSelectedTenantIdState(tenantId);\n  };\n\n  // Find selected tenant object\n  const selectedTenant = tenants.find(t => t.tenant_id === selectedTenantId) || null;\n\n  // Don't auto-select - require user to explicitly choose a client\n\n  return /*#__PURE__*/_jsxDEV(TenantContext.Provider, {\n    value: {\n      selectedTenantId,\n      selectedTenant,\n      setSelectedTenantId,\n      tenants,\n      isLoading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 79,\n    columnNumber: 5\n  }, this);\n};\n_s2(TenantProvider, \"PhTJSZtycjZSiLhKXw3cxohXwcY=\", false, function () {\n  return [useAuth, useQuery];\n});\n_c = TenantProvider;\nvar _c;\n$RefreshReg$(_c, \"TenantProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useAuth","adminService","useQuery","jsxDEV","_jsxDEV","TenantContext","undefined","useTenant","_s","context","Error","TenantProvider","children","_s2","user","isSuperAdmin","role","data","tenants","isLoading","queryKey","queryFn","getTenants","enabled","selectedTenantId","setSelectedTenantIdState","tenantId","stored","localStorage","getItem","setItem","removeItem","setSelectedTenantId","selectedTenant","find","t","tenant_id","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/LibsysAdmin/OneDrive - Libsys IT Services Private Limited/Desktop/ALLLL HLSC/client/src/context/TenantContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react'\r\nimport { useAuth } from './AuthContext'\r\nimport { adminService } from '../services/adminService'\r\nimport { useQuery } from '@tanstack/react-query'\r\n\r\ninterface Tenant {\r\n  tenant_id: string\r\n  name: string\r\n  subdomain: string\r\n  contact_email: string\r\n  status: 'active' | 'inactive' | 'suspended'\r\n}\r\n\r\ninterface TenantContextType {\r\n  selectedTenantId: string | null\r\n  selectedTenant: Tenant | null\r\n  setSelectedTenantId: (tenantId: string | null) => void\r\n  tenants: Tenant[]\r\n  isLoading: boolean\r\n}\r\n\r\nconst TenantContext = createContext<TenantContextType | undefined>(undefined)\r\n\r\nexport const useTenant = () => {\r\n  const context = useContext(TenantContext)\r\n  if (!context) {\r\n    throw new Error('useTenant must be used within TenantProvider')\r\n  }\r\n  return context\r\n}\r\n\r\nexport const TenantProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n  const { user } = useAuth()\r\n  const isSuperAdmin = user?.role === 'super_admin'\r\n  \r\n  // Fetch all tenants for super admin\r\n  const { data: tenants = [], isLoading } = useQuery({\r\n    queryKey: ['tenants'],\r\n    queryFn: adminService.getTenants,\r\n    enabled: isSuperAdmin, // Only fetch if super admin\r\n  })\r\n\r\n  // Initialize selected tenant from localStorage or use user's tenant\r\n  const [selectedTenantId, setSelectedTenantIdState] = useState<string | null>(() => {\r\n    if (!isSuperAdmin) {\r\n      // Regular users use their own tenant_id\r\n      return user?.tenantId || null\r\n    }\r\n    \r\n    // Super admin: try to load from localStorage\r\n    try {\r\n      const stored = localStorage.getItem('selectedTenantId')\r\n      return stored || null\r\n    } catch {\r\n      return null\r\n    }\r\n  })\r\n\r\n  // Update localStorage when selected tenant changes\r\n  useEffect(() => {\r\n    if (isSuperAdmin && selectedTenantId) {\r\n      localStorage.setItem('selectedTenantId', selectedTenantId)\r\n    } else if (isSuperAdmin && !selectedTenantId) {\r\n      localStorage.removeItem('selectedTenantId')\r\n    }\r\n  }, [selectedTenantId, isSuperAdmin])\r\n\r\n  // Set selected tenant function\r\n  const setSelectedTenantId = (tenantId: string | null) => {\r\n    setSelectedTenantIdState(tenantId)\r\n  }\r\n\r\n  // Find selected tenant object\r\n  const selectedTenant = tenants.find(t => t.tenant_id === selectedTenantId) || null\r\n\r\n  // Don't auto-select - require user to explicitly choose a client\r\n\r\n  return (\r\n    <TenantContext.Provider\r\n      value={{\r\n        selectedTenantId,\r\n        selectedTenant,\r\n        setSelectedTenantId,\r\n        tenants,\r\n        isLoading,\r\n      }}\r\n    >\r\n      {children}\r\n    </TenantContext.Provider>\r\n  )\r\n}\r\n"],"mappings":";;;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,SAAS,QAAmB,OAAO;AACxF,SAASC,OAAO,QAAQ,eAAe;AACvC,SAASC,YAAY,QAAQ,0BAA0B;AACvD,SAASC,QAAQ,QAAQ,uBAAuB;AAAA,SAAAC,MAAA,IAAAC,OAAA;AAkBhD,MAAMC,aAAa,gBAAGT,aAAa,CAAgCU,SAAS,CAAC;AAE7E,OAAO,MAAMC,SAAS,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC7B,MAAMC,OAAO,GAAGZ,UAAU,CAACQ,aAAa,CAAC;EACzC,IAAI,CAACI,OAAO,EAAE;IACZ,MAAM,IAAIC,KAAK,CAAC,8CAA8C,CAAC;EACjE;EACA,OAAOD,OAAO;AAChB,CAAC;AAAAD,EAAA,CANYD,SAAS;AAQtB,OAAO,MAAMI,cAAiD,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,GAAA;EACjF,MAAM;IAAEC;EAAK,CAAC,GAAGd,OAAO,CAAC,CAAC;EAC1B,MAAMe,YAAY,GAAG,CAAAD,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEE,IAAI,MAAK,aAAa;;EAEjD;EACA,MAAM;IAAEC,IAAI,EAAEC,OAAO,GAAG,EAAE;IAAEC;EAAU,CAAC,GAAGjB,QAAQ,CAAC;IACjDkB,QAAQ,EAAE,CAAC,SAAS,CAAC;IACrBC,OAAO,EAAEpB,YAAY,CAACqB,UAAU;IAChCC,OAAO,EAAER,YAAY,CAAE;EACzB,CAAC,CAAC;;EAEF;EACA,MAAM,CAACS,gBAAgB,EAAEC,wBAAwB,CAAC,GAAG3B,QAAQ,CAAgB,MAAM;IACjF,IAAI,CAACiB,YAAY,EAAE;MACjB;MACA,OAAO,CAAAD,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEY,QAAQ,KAAI,IAAI;IAC/B;;IAEA;IACA,IAAI;MACF,MAAMC,MAAM,GAAGC,YAAY,CAACC,OAAO,CAAC,kBAAkB,CAAC;MACvD,OAAOF,MAAM,IAAI,IAAI;IACvB,CAAC,CAAC,MAAM;MACN,OAAO,IAAI;IACb;EACF,CAAC,CAAC;;EAEF;EACA5B,SAAS,CAAC,MAAM;IACd,IAAIgB,YAAY,IAAIS,gBAAgB,EAAE;MACpCI,YAAY,CAACE,OAAO,CAAC,kBAAkB,EAAEN,gBAAgB,CAAC;IAC5D,CAAC,MAAM,IAAIT,YAAY,IAAI,CAACS,gBAAgB,EAAE;MAC5CI,YAAY,CAACG,UAAU,CAAC,kBAAkB,CAAC;IAC7C;EACF,CAAC,EAAE,CAACP,gBAAgB,EAAET,YAAY,CAAC,CAAC;;EAEpC;EACA,MAAMiB,mBAAmB,GAAIN,QAAuB,IAAK;IACvDD,wBAAwB,CAACC,QAAQ,CAAC;EACpC,CAAC;;EAED;EACA,MAAMO,cAAc,GAAGf,OAAO,CAACgB,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,SAAS,KAAKZ,gBAAgB,CAAC,IAAI,IAAI;;EAElF;;EAEA,oBACEpB,OAAA,CAACC,aAAa,CAACgC,QAAQ;IACrBC,KAAK,EAAE;MACLd,gBAAgB;MAChBS,cAAc;MACdD,mBAAmB;MACnBd,OAAO;MACPC;IACF,CAAE;IAAAP,QAAA,EAEDA;EAAQ;IAAA2B,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACa,CAAC;AAE7B,CAAC;AAAA7B,GAAA,CA3DYF,cAAiD;EAAA,QAC3CX,OAAO,EAIkBE,QAAQ;AAAA;AAAAyC,EAAA,GALvChC,cAAiD;AAAA,IAAAgC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}